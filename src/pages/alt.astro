---
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <div class="video-container">
        <video id="scrollVideo" playsinline preload="auto">
            <source src="/videos/Warp_PROXY_09.mp4" type="video/mp4">
        </video>
    </div>

    <div class="content h-[15000px]">
    </div>

    <style>
        .video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
            background: transparent;
        }

        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            will-change: transform;
        }

        .content {
            position: relative;
            z-index: 1;
            color: white;
            padding: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('scrollVideo') as HTMLVideoElement;
            video.load();

            // Get parameters from URL or use defaults
            const urlParams = new URLSearchParams(window.location.search);
            const fps = parseInt(urlParams.get('fps') || '40');
            const screenHeight = parseInt(urlParams.get('height') || '15000');

            // Update content height based on parameter
            const contentDiv = document.querySelector('.content') as HTMLDivElement;
            if (contentDiv) {
                contentDiv.style.height = `${screenHeight}px`;
            }

            let lastUpdate = 0;
            const throttleDelay = 1000 / fps; // Convert fps to milliseconds between updates

            window.addEventListener('scroll', () => {
                const now = performance.now();
                if (now - lastUpdate < throttleDelay) return;
                lastUpdate = now;

                const scrollTop = window.scrollY;
                const maxScroll = document.body.scrollHeight - window.innerHeight;

                const scrollFraction = scrollTop / maxScroll;
                const videoDuration = video.duration;

                console.log(scrollFraction * videoDuration, videoDuration);

                video.currentTime = scrollFraction * videoDuration;
            });
        });
    </script>
</Layout>